"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[140],{5318:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var i=n(7378);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),m=c(n),u=o,h=m["".concat(s,".").concat(u)]||m[u]||p[u]||a;return n?i.createElement(h,l(l({ref:t},d),{},{components:n})):i.createElement(h,l({ref:t},d))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:o,l[1]=r;for(var c=2;c<a;c++)l[c]=n[c];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2049:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var i=n(5773),o=n(808),a=(n(7378),n(5318)),l=["components"],r={sidebar_position:4,description:"How to request and access to LOC."},s="Legal Officer Case (LOC)",c={unversionedId:"client/loc",id:"client/loc",title:"Legal Officer Case (LOC)",description:"How to request and access to LOC.",source:"@site/docs/client/loc.md",sourceDirName:"client",slug:"/client/loc",permalink:"/logion-api/docs/client/loc",draft:!1,editUrl:"https://github.com/logion-network/logion-api/tree/main/website/docs/client/loc.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,description:"How to request and access to LOC."},sidebar:"tutorialSidebar",previous:{title:"Protection and Recovery",permalink:"/logion-api/docs/client/protection"}},d={},p=[{value:"State",id:"state",level:2},{value:"Transaction LOC",id:"transaction-loc",level:2},{value:"Lifecycle",id:"lifecycle",level:3},{value:"Request",id:"request",level:3},{value:"Metadata",id:"metadata",level:3},{value:"Collection LOC",id:"collection-loc",level:2},{value:"Lifecycle",id:"lifecycle-1",level:3},{value:"Request",id:"request-1",level:3},{value:"Collection Item",id:"collection-item",level:3},{value:"Collection WITHOUT upload support",id:"collection-without-upload-support",level:4},{value:"Collection WITH upload support",id:"collection-with-upload-support",level:4},{value:"Collection with restricted delivery",id:"collection-with-restricted-delivery",level:4},{value:"Terms and Conditions",id:"terms-and-conditions",level:4},{value:"Identity LOC",id:"identity-loc",level:2},{value:"Lifecycle",id:"lifecycle-2",level:3},{value:"Request",id:"request-2",level:3},{value:"Query",id:"query",level:2},{value:"Querying requests",id:"querying-requests",level:3},{value:"Querying LOCs",id:"querying-locs",level:3},{value:"Accessing LOC data",id:"accessing-loc-data",level:2}],m={toc:p};function u(e){var t=e.components,r=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,i.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"legal-officer-case-loc"},"Legal Officer Case (LOC)"),(0,a.kt)("h2",{id:"state"},"State"),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"An ",(0,a.kt)("a",{parentName:"p",href:"/logion-api/docs/client/authentication"},"authenticated client")," is necessary for all LOC operations.")),(0,a.kt)("p",null,"The global state of LOCs can be obtained (and later on, refreshed) with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const locsState = await client.locsState();\nconst refreshedState = await locsState.refresh();\n")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"All user operations (",(0,a.kt)("inlineCode",{parentName:"p"},"requestTransactionLoc"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"requestCollectionLoc"),", etc.), as well as ",(0,a.kt)("inlineCode",{parentName:"p"},"refresh"),", do return a new state.\nAlways use the most recent state, and discard the former state.\nIn the example above, the var ",(0,a.kt)("inlineCode",{parentName:"p"},"locsState")," must not be used any more as soon as ",(0,a.kt)("inlineCode",{parentName:"p"},"refreshedState")," is available.")),(0,a.kt)("h2",{id:"transaction-loc"},"Transaction LOC"),(0,a.kt)("h3",{id:"lifecycle"},"Lifecycle"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Loc State",src:n(5438).Z,width:"475",height:"774"})),(0,a.kt)("h3",{id:"request"},"Request"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const pendingRequest = await locsState.requestTransactionLoc({\n    legalOfficer: alice,\n    description: "This is a Transaction LOC",\n    userIdentity: {\n        email: "john.doe@invalid.domain",\n        firstName: "John",\n        lastName: "Doe",\n        phoneNumber: "+1234",\n    },\n});\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The user identity must not be added when the requesting account is protected by the legal officer")),(0,a.kt)("p",null,"Then you have to wait for the LO to open the LOC:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const openLoc = await pendingRequest.refresh() as OpenLoc;\n")),(0,a.kt)("h3",{id:"metadata"},"Metadata"),(0,a.kt)("p",null,"Metadata can be added to, or removed from, an open LOC:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="addMetadata"',title:'"addMetadata"'},'openLoc = await openLoc.addMetadata({\n    name: "Some name",\n    value: "Some value"\n});\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="deleteMetadata"',title:'"deleteMetadata"'},'openLoc = await openLoc.deleteMetadata({\n    name: "Some name"\n});\n')),(0,a.kt)("h2",{id:"collection-loc"},"Collection LOC"),(0,a.kt)("h3",{id:"lifecycle-1"},"Lifecycle"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Collection Loc State",src:n(5969).Z,width:"632",height:"789"})),(0,a.kt)("h3",{id:"request-1"},"Request"),(0,a.kt)("p",null,"A Collection LOC can be requested to a given Legal Officer by providing a description."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const pendingRequest = await locsState.requestCollectionLoc({\n    legalOfficer: alice,\n    description: "This is a Collection LOC",\n    userIdentity: {\n        email: "john.doe@invalid.domain",\n        firstName: "John",\n        lastName: "Doe",\n        phoneNumber: "+1234",\n    },\n});\n')),(0,a.kt)("p",null,"Then you have to wait for the LO to open and close the LOC:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const openLoc = await pendingRequest.refresh() as OpenLoc;\nconst closedLoc = await openLoc.refresh() as ClosedCollectionLoc;\n")),(0,a.kt)("h3",{id:"collection-item"},"Collection Item"),(0,a.kt)("p",null,"When opening the Collection LOC, the LO decides if it supports file upload or not."),(0,a.kt)("h4",{id:"collection-without-upload-support"},"Collection WITHOUT upload support"),(0,a.kt)("p",null,"Add an item to the collection:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Add Item"',title:'"Add','Item"':!0},'const itemId = "0xc53447c3d4e9d94d6f4ab926378c5b14bd66e28af619d4dcb066c862f8aeb455"; // SHA256 hash of "first-collection-item" (without the quotes)\nconst itemDescription = "First collection item";\nconst itemFileContent = "test";\nconst itemFileHash = hash(itemFileContent);\nclosedLoc = await closedLoc.addCollectionItem({\n    itemId,\n    itemDescription,\n    signer: state.signer\n});\n')),(0,a.kt)("p",null,"Later on, you can retrieve the item with its ID:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Get an Item"',title:'"Get',an:!0,'Item"':!0},"const item = await closedLoc.getCollectionItem({ itemId });\n")),(0,a.kt)("h4",{id:"collection-with-upload-support"},"Collection WITH upload support"),(0,a.kt)("p",null,'A collection item may have attached files if the collection permits it. The files are then stored in logion\'s private IPFS network\nensuring their availability over time. If a controlled delivery for attached files is needed, see "Collection with restricted delivery"\nbelow.'),(0,a.kt)("p",null,"There are 2 possibilities when attaching files to an item:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"immediate upload of the files upon item creation or"),(0,a.kt)("li",{parentName:"ul"},"item creation followed by an explicit upload later on.")),(0,a.kt)("p",null,"See the examples below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Add Item and provide file content"',title:'"Add',Item:!0,and:!0,provide:!0,file:!0,'content"':!0},'const firstItemId = hashString("first-collection-item");\nconst firstItemDescription = "First collection item";\nconst firstFileContent = "test";\nconst firstFileHash = hashString(firstFileContent);\nclosedLoc = await closedLoc.addCollectionItem({\n    itemId: firstItemId,\n    itemDescription: firstItemDescription,\n    signer: state.signer,\n    itemFiles: [\n        new ItemFileWithContent({\n            name: "test.txt",\n            contentType: MimeType.from("text/plain"),\n            hashOrContent: HashOrContent.fromContent(Buffer.from(firstFileContent)), // Let SDK compute hash and size\n        })\n    ],\n});\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Add Item and provide hash and size"',title:'"Add',Item:!0,and:!0,provide:!0,hash:!0,'size"':!0},'const secondItemId = hashString("second-collection-item");\nconst secondItemDescription = "Second collection item";\nconst secondFileContent = "test2";\nconst secondFileHash = hashString(secondFileContent);\nclosedLoc = await closedLoc.addCollectionItem({\n    itemId: secondItemId,\n    itemDescription: secondItemDescription,\n    signer: state.signer,\n    itemFiles: [\n        new ItemFileWithContent({\n            name: "test2.txt",\n            contentType: MimeType.from("text/plain"),\n            hashOrContent: HashOrContent.fromHash(secondFileHash), // No content, must upload later\n            size: 5n, // No content, must provide size\n        })\n    ]\n});\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Upload file for an existing item"',title:'"Upload',file:!0,for:!0,an:!0,existing:!0,'item"':!0},'closedLoc = await closedLoc.uploadCollectionItemFile({\n    itemId: secondItemId,\n    itemFile: new ItemFileWithContent({\n        name: "test2.txt",\n        contentType: MimeType.from("text/plain"),\n        hashOrContent: HashOrContent.fromContent(Buffer.from(firstFileContent)),\n    }),\n});\n')),(0,a.kt)("h4",{id:"collection-with-restricted-delivery"},"Collection with restricted delivery"),(0,a.kt)("p",null,'A collection item with restricted delivery requires a token definition i.e. the "address" of the token\nwhich opens access to the underlying files when owned. Below an example where the underlying files\nwill be delivered to the owner of an ERC-721 token on Ethereum Mainnet.'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Add Item with restricted delivery"',title:'"Add',Item:!0,with:!0,restricted:!0,'delivery"':!0},'const firstItemId = generateEthereumTokenItemId("202210131750", "4391");\nconst firstItemDescription = "First collection item";\nconst firstFileContent = "test";\nconst firstFileHash = hashString(firstFileContent);\nconst firstItemToken: ItemTokenWithRestrictedType = {\n    type: "ethereum_erc721",\n    id: \'{"contract":"0x765df6da33c1ec1f83be42db171d7ee334a46df5","id":"4391"}\'\n};\nclosedLoc = await closedLoc.addCollectionItem({\n    itemId: firstItemId,\n    itemDescription: firstItemDescription,\n    signer: state.signer,\n    itemFiles: [\n        new ItemFileWithContent({\n            name: "test.txt",\n            contentType: MimeType.from("text/plain"),\n            hashOrContent: HashOrContent.fromContent(Buffer.from(firstFileContent)),\n        })\n    ],\n    itemToken: firstItemToken,\n    restrictedDelivery: true,\n});\n')),(0,a.kt)("admonition",{type:"danger"},(0,a.kt)("p",{parentName:"admonition"},"In the above example, the item ID is generated using function ",(0,a.kt)("inlineCode",{parentName:"p"},"generateEthereumTokenItemId"),". This ensures that the item ID\nmatches the one computed by the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/logion-network/logion-solidity/blob/main/contracts/Logion.sol"},"logion Smart Contract"),".\n",(0,a.kt)("strong",{parentName:"p"},"This is very important because otherwise, the bidirectional link between the item and its token would be broken.\nThe nonce parameter must match the one in the Smart Contract.")),(0,a.kt)("p",{parentName:"admonition"},"One may consider not using the logion Smart Contract, leaving the choice of the item ID completely open, but this is not recommanded.")),(0,a.kt)("p",null,"This is the list of supported token types:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ethereum_erc721")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ethereum_erc1155")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"goerli_erc721")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"goerli_erc1155"))),(0,a.kt)("p",null,"With the above types, the ",(0,a.kt)("inlineCode",{parentName:"p"},"id")," field must represent a valid JSON object with 2 fields: ",(0,a.kt)("inlineCode",{parentName:"p"},"contract")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"id"),". Both fields are strings."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"contract")," is the address of the Smart Contract of the token."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"id")," is the token ID as assigned by the Smart Contract."),(0,a.kt)("h4",{id:"terms-and-conditions"},"Terms and Conditions"),(0,a.kt)("p",null,"Terms and conditions can be added to the collection item, using either the ",(0,a.kt)("inlineCode",{parentName:"p"},"LogionClassification"),",\na set of ",(0,a.kt)("inlineCode",{parentName:"p"},"SpecificLicense"),"s, or both."),(0,a.kt)("p",null,"As a prerequisite, a valid closed Transaction LOC defining the classification or license must exist.\n(referred as ",(0,a.kt)("inlineCode",{parentName:"p"},"logionClassification.locId")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"specificLicense.locId")," in the example below)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const itemId = "0xc53447c3d4e9d94d6f4ab926378c5b14bd66e28af619d4dcb066c862f8aeb455"; // SHA256 hash of "first-collection-item" (without the quotes)\nconst itemDescription = "First collection item";\nconst itemFileContent = "test";\nconst itemFileHash = hash(itemFileContent);\nclosedLoc = await closedLoc.addCollectionItem({\n    itemId,\n    itemDescription,\n    signer: state.signer,\n    logionClassification: new LogionClassification(logionClassificationLocRequest.locId, {\n        regionalLimit: [ "BE", "FR", "LU" ],\n        transferredRights: [ "PER-PRIV", "REG", "TIME" ],\n        expiration: "2025-01-01",\n    }),\n    specificLicenses: [ new SpecificLicense(specificLicense.locId, "Some details about the license") ]\n});\n')),(0,a.kt)("admonition",{title:"Logion Classification",type:"note"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"The Logion Classification allows to define a set of ",(0,a.kt)("inlineCode",{parentName:"li"},"transferredRights")," to define precisely the scope of the terms and conditions.\nAll possible transferred rights are available in ",(0,a.kt)("inlineCode",{parentName:"li"},"logionLicenseItems"),"."),(0,a.kt)("li",{parentName:"ul"},"With the code ",(0,a.kt)("inlineCode",{parentName:"li"},"TIME")," it is possible to limit the right in time by setting the parameter ",(0,a.kt)("inlineCode",{parentName:"li"},"expiration"),"."),(0,a.kt)("li",{parentName:"ul"},"With the code ",(0,a.kt)("inlineCode",{parentName:"li"},"REG")," it is possible to limit to some countries/regions with the parameter ",(0,a.kt)("inlineCode",{parentName:"li"},"regionalLimit"),"."))),(0,a.kt)("h2",{id:"identity-loc"},"Identity LOC"),(0,a.kt)("p",null,"Except for the request, described here, everything else is similar to the ",(0,a.kt)("a",{parentName:"p",href:"#transaction-loc"},"Transaction LOC"),"."),(0,a.kt)("h3",{id:"lifecycle-2"},"Lifecycle"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Identity Loc State",src:n(4098).Z,width:"475",height:"774"})),(0,a.kt)("h3",{id:"request-2"},"Request"),(0,a.kt)("p",null,"An Identity LOC is requested this way:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const pendingRequest = await locsState.requestIdentityLoc({\n    legalOfficer: alice,\n    description: "This is an Identity LOC",\n    userIdentity: {\n        email: "john.doe@invalid.domain",\n        firstName: "John",\n        lastName: "Doe",\n        phoneNumber: "+1234",\n    },\n    userPostalAddress: {\n        line1: "Peace Street",\n        line2: "2nd floor",\n        postalCode: "10000",\n        city: "MyCity",\n        country: "Wonderland"\n    }\n});\n')),(0,a.kt)("h2",{id:"query"},"Query"),(0,a.kt)("h3",{id:"querying-requests"},"Querying requests"),(0,a.kt)("p",null,"Pending and rejected requests can be queried:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const type: LocType = 'Transaction'; // could be 'Collection' or 'Identity'\nconst pendingRequests = locsState.pendingRequests[type];\nconst rejectedRequests = locsState.rejectedRequests[type];\n")),(0,a.kt)("h3",{id:"querying-locs"},"Querying LOCs"),(0,a.kt)("p",null,"Similarly, LOC's can be queried according to their state:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const type: LocType = 'Transaction'; // could be 'Collection' or 'Identity'\nconst openLocs = locsState.openLocs[type];\nconst closedLocs = locsState.closedLocs[type];\nconst voidedLocs = locsState.voidedLocs[type];\n")),(0,a.kt)("h2",{id:"accessing-loc-data"},"Accessing LOC data"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const locData: LocData = locsState.openLocs["Identity"][0].data();\nconst userIdentity = locData.userIdentity;\nconsole.log("Identity of %s: %s %s %s %s", \n    locData.requesterAddress, \n    userIdentity?.firstName, \n    userIdentity?.lastName, \n    userIdentity?.email, \n    userIdentity?.phoneNumber\n);\n')))}u.isMDXComponent=!0},5969:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/collection-state-a159ea83b7eb3b88e51aadd806186363.png"},4098:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/identity-loc-state-8d6fa9a39fa5f861d28be0bc096a1ef2.png"},5438:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/loc-state-ed123aeb8fb09835762a183154f86a1c.png"}}]);