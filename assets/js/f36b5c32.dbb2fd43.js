"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2918],{8556:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=n(1948),c=n(3460);const o={sidebar_position:5,description:"How to protect/recover a Polkadot account, and access the vault."},r="Protection and Recovery",i={id:"client/protection",title:"Protection and Recovery",description:"How to protect/recover a Polkadot account, and access the vault.",source:"@site/docs/client/protection.md",sourceDirName:"client",slug:"/client/protection",permalink:"/logion-api/docs/client/protection",draft:!1,unlisted:!1,editUrl:"https://github.com/logion-network/logion-api/tree/main/website/docs/client/protection.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,description:"How to protect/recover a Polkadot account, and access the vault."},sidebar:"tutorialSidebar",previous:{title:"Legal Officer Case (LOC)",permalink:"/logion-api/docs/client/loc"},next:{title:"Extension",permalink:"/logion-api/docs/category/extension"}},s={},l=[{value:"State",id:"state",level:2},{value:"Protection",id:"protection",level:2},{value:"Choose LLOs and LOCs",id:"choose-llos-and-locs",level:3},{value:"Activate your protection",id:"activate-your-protection",level:3},{value:"Vault",id:"vault",level:2},{value:"Transfer from vault",id:"transfer-from-vault",level:3},{value:"Transfer to vault",id:"transfer-to-vault",level:3},{value:"Check vault balance",id:"check-vault-balance",level:3},{value:"Recovery",id:"recovery",level:2},{value:"Overview of the whole process",id:"overview-of-the-whole-process",level:3},{value:"Request a recovery",id:"request-a-recovery",level:3},{value:"Activate the new protection",id:"activate-the-new-protection",level:3},{value:"Claim the recovery",id:"claim-the-recovery",level:3},{value:"Recover the lost balance",id:"recover-the-lost-balance",level:3},{value:"Recover the lost vault",id:"recover-the-lost-vault",level:3},{value:"Rejection Management",id:"rejection-management",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"protection-and-recovery",children:"Protection and Recovery"}),"\n",(0,a.jsx)(t.h2,{id:"state",children:"State"}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:["An ",(0,a.jsx)(t.a,{href:"/logion-api/docs/client/authentication",children:"authenticated client"})," is necessary for protection/recovery operations."]})}),"\n",(0,a.jsx)(t.p,{children:"The global state of protection or recovery can be obtained (and later on, refreshed) with:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const protectionState = await authenticatedClient.protectionState();\nconst refreshedState = await protectionState.refresh();\n"})}),"\n",(0,a.jsx)(t.admonition,{type:"caution",children:(0,a.jsxs)(t.p,{children:["All user operations (",(0,a.jsx)(t.code,{children:"activateProtection"}),"), as well as ",(0,a.jsx)(t.code,{children:"refresh"}),", do return a new state.\nAlways use the most recent state, and discard the former state.\nIn the example above, the var ",(0,a.jsx)(t.code,{children:"protectionState"})," must not be used any more as soon as ",(0,a.jsx)(t.code,{children:"refreshedState"})," is available."]})}),"\n",(0,a.jsx)(t.h2,{id:"protection",children:"Protection"}),"\n",(0,a.jsx)(t.p,{children:"The setup of a Polkadot account protection is a 2-steps process:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Choose 2 officers"})," among the official list of Logion Legal Officers."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"activate"})," the protection on-chain given a valid (i.e. closed and non-void) Identity LOC with each LLO."]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"choose-llos-and-locs",children:"Choose LLOs and LOCs"}),"\n",(0,a.jsx)(t.p,{children:"For below example to work, you will need a valid Identity LOC with both alice and bob."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'const legalOfficers = authenticatedClient.getLegalOfficers();\nconst locsState = await authenticatedClient.locsState();\n\nconst alice = authenticatedClient.getLegalOfficer("5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY");\nconst bob = authenticatedClient.getLegalOfficer("5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty");\nconst aliceLoc = locsState.closedLocs.Identity.find(\n    loc => loc.data().ownerAddress === alice.address\n        && loc.data().voidInfo === undefined\n);\nconst bobLoc = locsState.closedLocs.Identity.find(\n    loc => loc.data().ownerAddress === bob.address\n        && loc.data().voidInfo === undefined\n);\n'})}),"\n",(0,a.jsx)(t.h3,{id:"activate-your-protection",children:"Activate your protection"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const noProtection = await authenticatedClient.protectionState() as NoProtection;\nconst pending = await noProtection.activateProtection({\n    payload: {\n        legalOfficer1: alice,\n        legalOfficer2: bob,\n        requesterIdentityLoc1: aliceLoc,\n        requesterIdentityLoc2: bobLoc,\n    },\n    signer,\n});\n"})}),"\n",(0,a.jsx)(t.h2,{id:"vault",children:"Vault"}),"\n",(0,a.jsx)(t.p,{children:"Operations require an activated protection (see above)."}),"\n",(0,a.jsx)(t.h3,{id:"transfer-from-vault",children:"Transfer from vault"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'let activeProtection = (await authenticatedClient.protectionState()) as ActiveProtection;\n\nlet vaultState = await activeProtection.vaultState();\nconst vaultAddress = vaultState.vaultAddress;\nvaultState = await vaultState.createVaultTransferRequest({\n    legalOfficer: alice,\n    amount: new PrefixedNumber("1", NONE),\n    destination: REQUESTER_ADDRESS,\n    signer\n});\nconst pendingRequest = vaultState.pendingVaultTransferRequests[0];\n'})}),"\n",(0,a.jsx)(t.h3,{id:"transfer-to-vault",children:"Transfer to vault"}),"\n",(0,a.jsxs)(t.p,{children:["A transfer to the vault is similar to any other ",(0,a.jsx)(t.a,{href:"balance-transactions#transfer",children:"transfer"}),".\nSimply use ",(0,a.jsx)(t.code,{children:"vaultState.vaultAddress"})," as destination."]}),"\n",(0,a.jsx)(t.h3,{id:"check-vault-balance",children:"Check vault balance"}),"\n",(0,a.jsx)(t.p,{children:"You must fist wait for one Legal Officer acceptance, and then see the effect of the transfer on the vault balance:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'vaultState = await vaultState.refresh();\n\nconst balance = vaultState.balances[0];\nconsole.log("Balance :%s", `${balance.balance.coefficient.toInteger()}.${balance.balance.coefficient.toFixedPrecisionDecimals(2)}${balance.balance.prefix.symbol}`)\n'})}),"\n",(0,a.jsx)(t.h2,{id:"recovery",children:"Recovery"}),"\n",(0,a.jsx)(t.p,{children:"In order to recover a previously protected account, you must first create a new Polkadot account. Then follow these 3-stpes process:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Request a recovery"})," to the Legal Officers who protected the lost account."]}),"\n",(0,a.jsxs)(t.li,{children:["Upon acceptance and vouching of the recovery, ",(0,a.jsx)(t.strong,{children:"activate"})," the protection (of the new account) on the chain."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Claim"})," the recovery."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"One claimed, you can recover the lost assets."}),"\n",(0,a.jsx)(t.h3,{id:"overview-of-the-whole-process",children:"Overview of the whole process"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Recovery State Diagram",src:n(4544).c+"",width:"633",height:"782"})}),"\n",(0,a.jsx)(t.h3,{id:"request-a-recovery",children:"Request a recovery"}),"\n",(0,a.jsxs)(t.p,{children:["Recovery must be requested to the ",(0,a.jsx)(t.strong,{children:"same Legal Officers"})," who accepted to protect the lost account (in this case, Alice and Bob)."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const noProtection = await authenticatedClient.protectionState() as NoProtection;\nconst pending = await noProtection.requestRecovery({\n    payload: {\n        recoveredAddress: REQUESTER_ADDRESS,\n        legalOfficer1: alice,\n        legalOfficer2: bob,\n        requesterIdentityLoc1: aliceLoc,\n        requesterIdentityLoc2: bobLoc,\n    },\n    signer,\n});\n"})}),"\n",(0,a.jsx)(t.h3,{id:"activate-the-new-protection",children:"Activate the new protection"}),"\n",(0,a.jsx)(t.p,{children:"You must first wait for LO's acceptance and vouching, and then activate the new protection:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const accepted = (await pending.refresh()) as AcceptedProtection;\n\nlet pendingRecovery = await accepted.activate(signer) as PendingRecovery;\n"})}),"\n",(0,a.jsx)(t.h3,{id:"claim-the-recovery",children:"Claim the recovery"}),"\n",(0,a.jsx)(t.p,{children:"Finally, the recovery is claimed:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"pendingRecovery = await pendingRecovery.waitForFullyReady();\nconst claimed = await pendingRecovery.claimRecovery(signer);\n"})}),"\n",(0,a.jsx)(t.h3,{id:"recover-the-lost-balance",children:"Recover the lost balance"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const recoveredBalance = await claimed.recoveredBalanceState();\nawait recoveredBalance.transfer({\n    signer,\n    destination: NEW_ADDRESS,\n    amount: recoveredBalance.balances[0].available,\n});\n"})}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsx)(t.p,{children:"The destination may be any address, not necessarily the new account address."})}),"\n",(0,a.jsx)(t.h3,{id:"recover-the-lost-vault",children:"Recover the lost vault"}),"\n",(0,a.jsx)(t.p,{children:"As for any transfer from a vault, you must wait for one LO's approval."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'const newVault = await claimed.vaultState();\nlet recoveredVault = await claimed.recoveredVaultState();\nrecoveredVault = await recoveredVault.createVaultTransferRequest({\n    legalOfficer: alice,\n    amount: recoveredVault.balances[0].available,\n    destination: newVault.vaultAddress,\n    signer,\n});\n\n// ... Wait for LO\'s acceptance ...\nnewVault = await newVault.refresh();\n\n// Check Vault balance\nconst newBalance = newVault.balances[0];\nconsole.log("Balance :%s", `${newBalance.balance.coefficient.toInteger()}.${newBalance.balance.coefficient.toFixedPrecisionDecimals(2)}${newBalance.balance.prefix.symbol}`);\n'})}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsx)(t.p,{children:"The destination may be any address, not necessarily the new vault address."})}),"\n",(0,a.jsx)(t.h3,{id:"rejection-management",children:"Rejection Management"}),"\n",(0,a.jsx)(t.p,{children:"If rejected by one or more Legal Officer, you may either"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Resubmit the request to the officer who rejected,"}),"\n",(0,a.jsx)(t.li,{children:"Or completely cancel your recovery request."}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",metastring:'title="Resubmit to LO who rejected"',children:'let rejectedRecovery = (await authenticatedClient.protectionState()) as RejectedRecovery;\nconst rejecter = rejectedRecovery.protectionParameters.states.find(state => state.status === "REJECTED")!.legalOfficer;\nrejectedRecovery.resubmit(rejecter);\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",metastring:'title="Cancel the recovery request"',children:"let rejectedRecovery = (await authenticatedClient.protectionState()) as RejectedRecovery;\nrejectedRecovery.cancel();\n"})})]})}function h(e={}){const{wrapper:t}={...(0,c.M)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},4544:(e,t,n)=>{n.d(t,{c:()=>a});const a=n.p+"assets/images/recovery-state-1d40e8678be3fc82f70319821e6fbde1.png"},3460:(e,t,n)=>{n.d(t,{I:()=>i,M:()=>r});var a=n(6952);const c={},o=a.createContext(c);function r(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);